<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Hypotheektool Cas & Jolijn</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // üîê Eenvoudige toegangscodebeveiliging
    const toegangscode = "eliosam";
    if (sessionStorage.getItem("toegangVerleend") !== "true") {
      const invoer = prompt("Toegangscode vereist:");
      if (invoer !== toegangscode) {
        alert("Ongeldige toegangscode.");
        document.write("<h1 style='text-align:center;margin-top:20vh;font-family:sans-serif;'>Toegang geweigerd</h1>");
        throw new Error("Toegang geweigerd");
      } else {
        sessionStorage.setItem("toegangVerleend", "true");
      }
    }
  </script>
</head>
<body class="bg-gray-50 text-gray-800 p-6">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold mb-4">üè† Hypotheektool Cas & Jolijn</h1>

    <form id="hypotheekForm" class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-white p-6 rounded shadow">
      <div><label class="block">Koopprijs woning</label><input type="number" id="koopprijs" value="410000" class="w-full border p-2 rounded" /></div>
      <div><label class="block">Taxatiewaarde woning</label><input type="number" id="taxatiewaarde" value="400000" class="w-full border p-2 rounded" /></div>
      <div><label class="block">Energielabel</label>
        <select id="energielabel" class="w-full border p-2 rounded">
          <option value="A">A</option><option value="B" selected>B</option>
          <option value="C">C</option><option value="D">D</option><option value="E">E</option><option value="F">F</option><option value="G">G</option>
        </select>
      </div>
      <div><label class="block">Eigen geld</label><input type="number" id="eigengeld" value="5000" class="w-full border p-2 rounded" /></div>
      <div><label class="block">Hoogte hypotheek</label><input type="number" id="hypotheek" value="280000" class="w-full border p-2 rounded" /></div>
      <div><label class="block">Rente hypotheek (%)</label><input type="number" step="0.01" id="renteHypotheek" value="3.7" class="w-full border p-2 rounded" /></div>
      <div><label class="block">Familiebank 1</label><input type="number" id="familiebank1" value="65000" class="w-full border p-2 rounded" /></div>
      <div><label class="block">Familiebank 2</label><input type="number" id="familiebank2" value="65000" class="w-full border p-2 rounded" /></div>
      <div><label class="block">Rente familiebank (%)</label><input type="number" step="0.01" id="renteFamiliebank" value="5" class="w-full border p-2 rounded" /></div>
      <div><label class="block">Terugschenking ouders (%)</label><input type="number" step="0.1" id="schenkingProcent" value="33" class="w-full border p-2 rounded" /></div>
      <div><label class="block">Marktconforme rente (%)</label><input type="number" step="0.01" id="marktconformeRente" value="4.5" class="w-full border p-2 rounded" /></div>
      <div><label class="block">Inkomen Cas</label><input type="number" id="inkomenCas" value="39000" class="w-full border p-2 rounded" /></div>
      <div><label class="block">Inkomen Jolijn</label><input type="number" id="inkomenJolijn" value="29000" class="w-full border p-2 rounded" /></div>
      <div><label class="block">Kosten koper</label><input type="number" id="kostenKoper" value="15000" class="w-full border p-2 rounded" /></div>
      <div><label class="block">Studieschuld</label><input type="number" id="studieschuld" value="29000" class="w-full border p-2 rounded" /></div>
    </form>

    <div id="uitleg" class="text-sm text-gray-600 mt-4 italic"></div>

    <h2 class="text-xl font-bold mt-10 mb-2">üìä Financieringsconstructie</h2>
    <div class="overflow-x-auto"><table class="min-w-full bg-white rounded shadow text-sm"><tbody id="constructieTabel"></tbody></table></div>

    <h2 class="text-xl font-bold mt-10 mb-2">üìâ Maandlasten (bruto & netto)</h2>
    <div class="overflow-x-auto"><table class="min-w-full bg-white rounded shadow text-sm">
      <thead class="bg-gray-100">
        <tr><th class="p-2 text-left">Component</th><th class="p-2 text-left">Bruto (‚Ç¨)</th><th class="p-2 text-left">Netto (‚Ç¨)</th></tr>
      </thead>
      <tbody id="maandlastTabel"></tbody>
    </table></div>
  </div>

  <script>
    const form = document.getElementById("hypotheekForm");
    const constructieTabel = document.getElementById("constructieTabel");
    const maandlastTabel = document.getElementById("maandlastTabel");
    const uitlegBox = document.getElementById("uitleg");

    form.oninput = updateTables;

    function schatBelastingdruk(inkomen) {
      const zelfstandigenaftrek = 3750;
      const mkbVrijstelling = 0.1331;
      const algemeneKorting = 3000;
      const arbeidskorting = Math.max(0, Math.min(5000, inkomen * 0.15));
      const belastbaar = Math.max(0, inkomen - zelfstandigenaftrek);
      const belastbaarNaMkb = belastbaar * (1 - mkbVrijstelling);
      const belasting = belastbaarNaMkb * 0.3697;
      const korting = Math.min(algemeneKorting + arbeidskorting, belasting);
      return Math.max(0, belasting - korting);
    }

    function updateTables() {
      const koopprijs = +form.koopprijs.value || 0;
      const taxatiewaarde = +form.taxatiewaarde.value || 0;
      const energielabel = form.energielabel.value;
      const eigenGeld = +form.eigengeld.value || 0;
      const hypotheek = +form.hypotheek.value || 0;
      const renteHypotheek = (+form.renteHypotheek.value || 0) / 100;
      const fb1 = +form.familiebank1.value || 0;
      const fb2 = +form.familiebank2.value || 0;
      const renteFBInput = (+form.renteFamiliebank.value || 0) / 100;
      const marktconformeRente = (+form.marktconformeRente.value || 0) / 100;
      let renteFB = renteFBInput;
      let schenkingPct = (+form.schenkingProcent.value || 0) / 100;
    
      const inkomenCas = +form.inkomenCas.value || 0;
      const inkomenJolijn = +form.inkomenJolijn.value || 0;
      const kostenKoper = +form.kostenKoper.value || 0;
      const studieschuld = +form.studieschuld.value || 0;

      const energielabelCorrectie = energielabel === "A" || energielabel === "B" ? 5000 : (["D","E","F"].includes(energielabel) ? -5000 : 0);
      const totaalFamiliebank = fb1 + fb2;
      const totaalFinanciering = hypotheek + totaalFamiliebank + eigenGeld + energielabelCorrectie;
      const overbieding = Math.max(0, koopprijs - taxatiewaarde);
      const totaleKosten = overbieding + kostenKoper + studieschuld;
      const restNaKosten = totaalFinanciering - totaleKosten;

      const brutoHypotheek = hypotheek * 0.0054 * renteHypotheek / 0.038;
      const brutoFamiliebank = totaalFamiliebank * 0.0054 * renteFB / 0.05;
      const renteHypMaand = hypotheek * renteHypotheek / 12;
      const renteFBMaand = totaalFamiliebank * renteFB / 12 * 0.75;
      const renteAftrekCas = Math.min((renteHypMaand + renteFBMaand) / 2, schatBelastingdruk(inkomenCas) / 12) * 0.37;
      const renteAftrekJolijn = Math.min((renteHypMaand + renteFBMaand) / 2, schatBelastingdruk(inkomenJolijn) / 12) * 0.37;
      const totaleRenteAftrek = renteAftrekCas + renteAftrekJolijn;
      const schenkingMaand = totaalFamiliebank * renteFB * schenkingPct / 12;
      const nettoHypotheek = brutoHypotheek - renteHypMaand * 0.37;
      const nettoFamiliebank = brutoFamiliebank - renteFBMaand * 0.37 - schenkingMaand;
      const nettoTotaal = brutoHypotheek + brutoFamiliebank - totaleRenteAftrek - schenkingMaand;

      constructieTabel.innerHTML = `
        <tr><td class="p-2">Hypotheek</td><td class="p-2">‚Ç¨${hypotheek.toLocaleString()}</td></tr>
        <tr><td class="p-2">Familiebank 1</td><td class="p-2">‚Ç¨${fb1.toLocaleString()}</td></tr>
        <tr><td class="p-2">Familiebank 2</td><td class="p-2">‚Ç¨${fb2.toLocaleString()}</td></tr>
        <tr><td class="p-2">Eigen geld</td><td class="p-2">‚Ç¨${eigenGeld}</td></tr>
        <tr><td class="p-2">Correctie energielabel (${energielabel})</td><td class="p-2">‚Ç¨${energielabelCorrectie}</td></tr>
        <tr><td class="p-2 font-bold">Totale financiering</td><td class="p-2 font-bold">‚Ç¨${totaalFinanciering.toLocaleString()}</td></tr>
        <tr><td class="p-2">Kosten koper</td><td class="p-2">‚Ç¨${kostenKoper}</td></tr>
        <tr><td class="p-2">Studieschuld</td><td class="p-2">‚Ç¨${studieschuld}</td></tr>
        <tr><td class="p-2">Overbieding</td><td class="p-2">‚Ç¨${overbieding}</td></tr>
        <tr><td class="p-2 font-bold">Resterend na kosten</td><td class="p-2 font-bold">‚Ç¨${Math.round(restNaKosten)}</td></tr>
      `;

      maandlastTabel.innerHTML = `
        <tr>
          <td class="p-2">Hypotheek</td>
          <td class="p-2">‚Ç¨${brutoHypotheek.toFixed(0)}</td>
          <td class="p-2">‚Ç¨${nettoHypotheek.toFixed(0)}</td>
        </tr>
        <tr>
          <td class="p-2">Familiebank</td>
          <td class="p-2">‚Ç¨${brutoFamiliebank.toFixed(0)}</td>
          <td class="p-2">‚Ç¨${nettoFamiliebank.toFixed(0)}</td>
        </tr>
        <tr>
          <td class="p-2">Renteaftrek (totaal)</td>
          <td class="p-2">-‚Ç¨${totaleRenteAftrek.toFixed(0)} p/m (Cas: ‚Ç¨${renteAftrekCas.toFixed(0)}, Jolijn: ‚Ç¨${renteAftrekJolijn.toFixed(0)})</td>
          <td class="p-2">-‚Ç¨${totaleRenteAftrek.toFixed(0)} p/m (Cas: ‚Ç¨${renteAftrekCas.toFixed(0)}, Jolijn: ‚Ç¨${renteAftrekJolijn.toFixed(0)})</td>
        </tr>
        <tr>
          <td class="p-2">Schenking ouders</td>
          <td class="p-2">-‚Ç¨${schenkingMaand.toFixed(0)} p/m</td>
          <td class="p-2">-‚Ç¨${schenkingMaand.toFixed(0)} p/m</td>
        </tr>
        <tr>
          <th class="p-2">Totaal</th>
          <th class="p-2">‚Ç¨${(brutoHypotheek + brutoFamiliebank).toFixed(0)}</th>
          <th class="p-2">‚Ç¨${nettoTotaal.toFixed(0)}</th>
        </tr>
      `;
    }

    updateTables();
  </script>
</body>
</html>
